---
id: 01KH2GN45747AHHBATJ45G93Z5
type: design
requires: 01KH2GJDA2R5MXP83SXKFW4X32
title: キャッシュディレクトリ管理実装設計
created: 2026-02-10T00:54:06.247Z
updated: 2026-02-10T05:29:45.553Z
content: |-
  ## 実装ファイル

  `packages/mcp-git-repo-explorer/src/git/resolver.ts`

  ## ハッシュ生成

  ```typescript
  import { createHash } from "crypto";

  function hashUrl(url: string): string {
    return createHash("sha256")
      .update(url)
      .digest("hex")
      .slice(0, 12);
  }
  ```

  ## clone/fetchロジック

  ```typescript
  async function ensureRepo(url: string, cachePath: string): Promise<void> {
    if (existsSync(cachePath)) {
      await execFile("git", ["fetch", "--all"], { cwd: cachePath });
    } else {
      await execFile("git", ["clone", "--bare", url, cachePath]);
    }
  }
  ```

  ## CLIエントリーポイント

  ```typescript
  // index.ts
  const cacheDir = process.argv[2] ?? "/tmp/mcp-git-repos";
  ```
filePath: docs/chain/design/01KH2GN45747AHHBATJ45G93Z5.md
---

## 実装ファイル

`packages/mcp-git-repo-explorer/src/git/resolver.ts`

## ハッシュ生成

```typescript
import { createHash } from "crypto";

function hashUrl(url: string): string {
  return createHash("sha256")
    .update(url)
    .digest("hex")
    .slice(0, 12);
}
```

## clone/fetchロジック

```typescript
async function ensureRepo(url: string, cachePath: string): Promise<void> {
  if (existsSync(cachePath)) {
    await execFile("git", ["fetch", "--all"], { cwd: cachePath });
  } else {
    await execFile("git", ["clone", "--bare", url, cachePath]);
  }
}
```

## CLIエントリーポイント

```typescript
// index.ts
const cacheDir = process.argv[2] ?? "/tmp/mcp-git-repos";
```
